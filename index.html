<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>GenreQuest</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

  <!-- Additional CSS Files -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="./style.css">
</head>

<body>
  <nav class="nav">
    <div class="nav-logo">
      <p><br>GenreQuest</p>
    </div>
    <div class="nav-menu" id="navMenu">
      <ul>
        <li><a href="GQhome.html" class="link">Home</a></li>
        <li><a href="index.html" class="link active">Top 100</a></li>
        <li><a href="GQbrowser.html" class="link">Browse</a></li>
        <li><a href="Forum.html" class="link">Forum</a></li>
        <li><a href="GQlogin.html" class="link">Login</a></li>
      </ul>
    </div>
  </nav>
  <br>
  <br>
  <br>
  <br>
  <div class="filter-container">
    <div class="genre-filter-wrapper">
      <button class="genre-filter active" data-genre="all">All</button>
      <button class="genre-filter" data-genre="action">Action</button>
      <button class="genre-filter" data-genre="adventure">Adventure</button>
      <button class="genre-filter" data-genre="rpg">RPG</button>
    </div>
    <div class="rating-filter-wrapper">
      <select class="rating-filter">
        <option value="all">All Ratings</option>
        <option value="4.5+">4.5+</option>
        <option value="4">4+</option>
        <option value="3.5">3.5+</option>
      </select>
      <button class="reset-filter">Reset</button>
    </div>
  </div>
</div>
  <!-- ***** Preloader Start ***** -->
  <div id="js-preloader" class="js-preloader loaded">
    <div class="preloader-inner">
      <span class="dot"></span>
      <div class="dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>
  <!-- ***** Preloader End ***** -->

  <div class="container-fluid">
    <div class="row">
      <div class="col-lg-12">
        <div class="most-popular">
          <div class="row">
            <div class="col-lg-12">
              <div class="heading-section">
                <br>
                <br>
              </div>
              <div class="row gameList">
                
              </div>
              <div class="col-lg-12">
                <div class="main-button hidden">
                  <a href="javascript:void(0)">Load More Games</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>


<script>
  const gameList = document.querySelector(".gameList");
  const loaderEl = document.getElementById("js-preloader");
  const loadMoreGamesBtn = document.querySelector(".main-button");
  const APIKEY = '4c19a194643944708174f65954be4868';

  let nextGameListUrl = null;

  const url = `https://api.rawg.io/api/games?key=${APIKEY}&dates=2022-01-01,2022-12-31&ordering=-added`;

  const getGenreStr = (genres) => {
    const genreStr = genres.map(genre => genre.name).join(", ");
    if (genreStr.length > 20) {
      return genreStr.substring(0, 20) + "...";
    }
    return genreStr;
  }

  function loadGames(url) {
    loaderEl.classList.remove("loaded");
  
    fetch(url)
      .then(response => {
        if (response.status === 200) {
          return response.json();
        } else {
          console.log("An error occurred:", response.statusText);
        }
      })
      .then(data => {
        if (data) {
          nextGameListUrl = data.next ? data.next : null;
          const games = data.results;
  
          games.forEach(game => {
            const gameItemEl = document.createElement("div");
            gameItemEl.classList.add("col-lg-3", "col-md-6", "col-sm-12", "item");
      
            gameItemEl.id = game.id; 
  
            gameItemEl.innerHTML = `
              <img src="${game.background_image}" alt="${game.name} image">
              <h4 class="game-name">${game.name.length > 20 ? game.name.substring(0, 20) + "..." : game.name}<br><span class="genres">${getGenreStr(game.genres)}</span></h4>
              <ul>
                <li><i class="fa fa-star"></i> <span class="rating">${game.rating}</span></li>
                <li><i class="fa-regular fa-calendar"></i> <span class="date">${game.released}</span></li>
              </ul>
            `;
            
            gameList.appendChild(gameItemEl);
          });
          loaderEl.classList.add("loaded");
          if (nextGameListUrl) {
            loadMoreGamesBtn.classList.remove("hidden");
          } else {
            loadMoreGamesBtn.classList.add("hidden");
          }
        }
      })
      .catch(error => {
        console.log("An error occurred:", error);
      });
  }
  

  // load games
  loadGames(url);

  loadMoreGamesBtn.addEventListener("click", () => {
    if (nextGameListUrl) {
      loadGames(nextGameListUrl);
    }
  });

  const genreButtons = document.querySelectorAll(".genre-filter");
  const ratingFilter = document.querySelector(".rating-filter");

  const filterGamesByGenre = (genre) => {
    if (genre === 'all') {
      loadGames(url);
      return;
    }

    const genreUrl = url + `&genres=${genre}`;
    loadGames(genreUrl);
  };

  const filterGamesByRating = (rating) => {
    const filteredGames = [];
    for (const game of gameList.children) {
      filteredGames.push(game);
    }
    clearGameList();
    appendGames(filteredGames);
  };

  const clearGameList = () => {
    while (gameList.firstChild) {
      gameList.removeChild(gameList.firstChild);
    }
  };

  const appendGames = (games) => {
    for (const game of games) {
      gameList.appendChild(game);
    }
  };

  genreButtons.forEach((button) => {
    button.addEventListener("click", () => {
      filterGamesByGenre(button.dataset.genre);
    });
  });

  ratingFilter.addEventListener("change", () => {
    filterGamesByRating(ratingFilter.value);
  });
</script>

</html>